"use strict";(self.webpackChunktaro_docs=self.webpackChunktaro_docs||[]).push([[68009],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(n),d=o,h=m["".concat(p,".").concat(d)]||m[d]||u[d]||r;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},27839:function(e,t,n){n.d(t,{hn:function(){return o},p6:function(){return r},gQ:function(){return l}});var a=n(67294),o=function(){return a.createElement("span",{className:"footer_link_connect_wrap"},a.createElement("span",{className:"footer_link_connect footer_link_wechat"},"WeChat Developer Group",a.createElement("span",{className:"wechat_qrcode_icon"},a.createElement("svg",{t:"1554966525626",className:"icon svgicon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"https://www.w3.org/2000/svg","p-id":"2588","data-spm-anchor-id":"a313x.7781069.0.i0"},a.createElement("path",{d:"M240.071 241.095h59.278v59.278h-59.278v-59.278z",fill:"","p-id":"2589"}),a.createElement("path",{d:"M405.959 134.485h-272.611v272.611h106.723v47.445h59.278v-47.445h106.723v-59.278h47.445v-47.445h-47.445l-0.114-165.888zM346.795 347.819h-154.169v-154.055h154.055v154.055h0.114zM240.071 727.154h59.278v59.278h-59.278v-59.278zM726.016 241.095h59.278v59.278h-59.278v-59.278zM512.683 509.042v63.943h59.278v-59.165h47.445v-59.278h-47.445v-47.445h-59.278v101.945zM512.683 725.789v60.643h59.278v-106.723h47.445v-59.278h-106.723v105.358zM571.961 786.432h47.445v47.445h-47.445v-47.445zM453.405 833.877v59.165h118.557v-59.165h-118.557z",fill:"","p-id":"2590"}),a.createElement("path",{d:"M678.685 679.709h-59.278v106.723h106.61v-59.278h-47.331v-47.445zM726.016 893.042h166.002v-59.165h-106.723v-47.445h-59.278v106.61zM892.018 513.821v-59.278h-106.723v59.278h106.723zM832.739 727.154h59.278v59.278h-59.278v-59.278zM453.405 347.819h59.278v59.278h-59.278v-59.278zM726.016 454.542v-47.445h166.002v-272.611h-272.611v59.278h-106.723v47.445h106.723v59.165h-47.445v47.445h47.445v59.278h59.278v47.445h47.331zM678.685 193.763h154.055v154.055h-154.055v-154.055zM678.685 572.985h47.331v47.445h-47.331v-47.445zM785.294 679.709h-59.278v47.445h106.723v-106.723h59.278v-47.445h-106.723v106.723zM453.405 241.095h59.278v59.278h-59.278v-59.278zM299.349 513.821h47.445v59.165h-47.445v-59.165zM453.405 454.542h-106.61v59.278h59.165v59.165h47.445v-118.443z",fill:"","p-id":"2591"}),a.createElement("path",{d:"M405.959 786.432v-106.723h47.445v-59.278h-213.333v-106.61h-106.723v59.278h59.278v47.445h-59.278v272.611h272.611v-59.278h47.445v-47.445h-47.445zM346.795 833.877h-154.169v-154.169h154.055v154.169h0.114zM453.405 572.985h59.278v47.445h-59.278v-47.445zM619.406 513.821h59.278v59.165h-59.278v-59.165zM726.016 513.821h59.278v59.165h-59.278v-59.165z",fill:"","p-id":"2592"})))),a.createElement("span",{className:"footer_link_wechat_img inline"},a.createElement("img",{src:"https://camo.githubusercontent.com/10834a234b99a5880b5dff7c0ca7235e2a0772e7/687474703a2f2f696d6732302e333630627579696d672e636f6d2f7562612f6a66732f7432303139372f3238332f313638373136383837342f3133363034322f32623464383131662f35623330613635634e39643166303366312e706e67"})))};function r(){return a.createElement("span",null,a.createElement("svg",{xmlns:"https://www.w3.org/2000/svg",className:"inline-svg-icon",viewBox:"0 0 1024 1024"},a.createElement("defs",null,a.createElement("style",null)),a.createElement("path",{fill:"#41B883",d:"M615.6 123.6h165.5L512 589.7 242.9 123.6H63.5L512 900.4l448.5-776.9z"}),a.createElement("path",{fill:"#34495E",d:"M781.1 123.6H615.6L512 303 408.4 123.6H242.9L512 589.7z"})),a.createElement("span",{style:{color:i}},"Vue"))}var i="#4fc08d";function l(){return a.createElement("span",null,a.createElement("svg",{xmlns:"https://www.w3.org/2000/svg",width:"200",height:"200",className:"inline-svg-icon",viewBox:"0 0 1024 1024"},a.createElement("defs",null,a.createElement("style",null)),a.createElement("path",{fill:"#61DAFB",d:"M432 511.8a80 80 0 10160 0 80 80 0 10-160 0z"}),a.createElement("path",{fill:"#61DAFB",d:"M960.5 511.8c0-62.8-73.8-117.2-188.5-150.1 28.9-115.8 18.7-206.9-35.7-238.3-54.5-31.4-138.5 5.3-224.3 88.2-85.8-82.9-169.8-119.6-224.3-88.2-54.4 31.4-64.6 122.6-35.7 238.3C137.3 394.6 63.5 449 63.5 511.8S137.3 629 252 661.9c-28.9 115.7-18.7 206.9 35.7 238.3 13.4 7.8 28.6 11.6 45.2 11.6 39.7 0 87.8-21.8 140-64.2 13-10.6 26.1-22.6 39.1-35.2 13 12.6 26.1 24.6 39.1 35.2 52.2 42.4 100.2 64.2 140 64.2 16.6 0 31.8-3.8 45.2-11.6 54.4-31.4 64.6-122.5 35.7-238.3 114.7-32.9 188.5-87.3 188.5-150.1zM716.8 157.2c35.3 20.4 42.7 94.3 17.6 194.8-36.7-8.4-76.7-14.7-119.3-18.6-24.7-34.9-50.2-66.4-75.8-94 59.2-57.3 114.2-88.4 152-88.4 9.6-.1 18.2 2 25.5 6.2zM637 584c-13.8 24-28.4 47-43.3 69-26.1 2-53.3 3.1-81.7 3.1-28.3 0-55.5-1.1-81.6-3.1-15-22-29.5-45.1-43.3-69-14.1-24.5-26.7-48.6-38.1-72.2 11.4-23.6 24-47.7 38.1-72.2 14.1-24.5 28.7-47.4 43.4-69.1 26.1-2 53.3-3.1 81.6-3.1 28.3 0 55.5 1.1 81.6 3.1 14.7 21.6 29.3 44.6 43.4 69 14.1 24.5 26.7 48.6 38.1 72.2-11.5 23.7-24.1 47.8-38.2 72.3zm58.8-26.4c11.2 26.6 20.4 52.1 28 76.5-24.9 5.6-51.7 10.4-80.3 14 9.3-14.5 18.4-29.3 27.3-44.6 8.8-15.4 17.1-30.7 25-45.9zM512 756.5c-17.7-19.2-35.1-40.1-52.2-62.6 17.1.8 34.5 1.3 52.2 1.3 17.7 0 35.1-.5 52.2-1.3-17.1 22.5-34.5 43.4-52.2 62.6zM380.5 648.1c-28.6-3.6-55.3-8.4-80.3-14 7.6-24.4 16.8-49.9 28-76.5 7.9 15.2 16.1 30.5 25 45.9 8.9 15.2 18 30 27.3 44.6zM328.2 466c-11.2-26.6-20.4-52.1-28-76.5 24.9-5.6 51.6-10.4 80.2-14-9.2 14.4-18.4 29.2-27.2 44.6-8.8 15.4-17.1 30.7-25 45.9zM512 267.1c17.3 18.7 34.8 39.8 52.1 62.7-17.1-.8-34.4-1.3-52.1-1.3-17.7 0-35 .5-52.1 1.3 17.3-22.9 34.8-44 52.1-62.7zm158.7 153c-8.9-15.3-18-30.1-27.2-44.6 28.6 3.6 55.3 8.4 80.2 14-7.6 24.4-16.8 49.9-28 76.5-7.8-15.2-16.1-30.5-25-45.9zM307.2 157.2c7.2-4.2 15.8-6.2 25.6-6.2 37.8 0 92.7 31.1 151.9 88.4-25.6 27.6-51.1 59.2-75.8 94-42.5 3.9-82.6 10.2-119.3 18.6-25.1-100.6-17.6-174.5 17.6-194.8zM102.5 511.8c0-40.8 60.3-84.2 160-112.6 11.1 36 25.6 73.8 43.5 112.6-17.8 38.8-32.4 76.6-43.5 112.6-99.7-28.4-160-71.9-160-112.6zm345.8 305.5c-59.7 48.5-111.1 66.4-141.1 49.2-35.3-20.4-42.7-94.3-17.6-194.8 36.7 8.4 76.7 14.7 119.3 18.6 24.4 34.5 49.9 66.1 75.8 94.2-12.1 11.7-24.2 22.9-36.4 32.8zm268.5 49.2c-29.9 17.3-81.4-.6-141.1-49.2-12.1-9.9-24.3-21.1-36.5-32.8 26-28.1 51.4-59.7 75.8-94.2 42.5-3.9 82.6-10.2 119.3-18.7 25.2 100.6 17.7 174.5-17.5 194.9zm44.8-242.1c-11.1-36-25.6-73.8-43.5-112.6 17.8-38.8 32.4-76.6 43.5-112.6 99.7 28.5 160 71.9 160 112.6-.1 40.7-60.4 84.2-160 112.6z"})),a.createElement("span",{style:{color:"#61dafb"}},"React"))}},58215:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:o},t)}},55064:function(e,t,n){n.d(t,{Z:function(){return m}});var a=n(83117),o=n(67294),r=n(72389),i=n(79443);var l=function(){var e=(0,o.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},p=n(83039),s=n(86010),c="tabItem_1uMI";function u(e){var t,n,a,r=e.lazy,i=e.block,u=e.defaultValue,m=e.values,d=e.groupId,h=e.className,f=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=m?m:f.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),g=(0,p.lx)(v,(function(e,t){return e.value===t.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var k=null===u?u:null!=(t=null!=u?u:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=f[0])?void 0:a.props.value;if(null!==k&&!v.some((function(e){return e.value===k})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=l(),w=b.tabGroupChoices,y=b.setTabGroupChoices,N=(0,o.useState)(k),T=N[0],x=N[1],C=[],z=(0,p.o5)().blockElementScrollPositionUntilNextRender;if(null!=d){var M=w[d];null!=M&&M!==T&&v.some((function(e){return e.value===M}))&&x(M)}var D=function(e){var t=e.currentTarget,n=C.indexOf(t),a=v[n].value;a!==T&&(z(t),x(a),null!=d&&y(d,a))},E=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=C.indexOf(e.currentTarget)+1;n=C[a]||C[0];break;case"ArrowLeft":var o=C.indexOf(e.currentTarget)-1;n=C[o]||C[C.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":i},h)},v.map((function(e){var t=e.value,n=e.label;return o.createElement("li",{role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,className:(0,s.Z)("tabs__item",c,{"tabs__item--active":T===t}),key:t,ref:function(e){return C.push(e)},onKeyDown:E,onFocus:D,onClick:D},null!=n?n:t)}))),r?(0,o.cloneElement)(f.filter((function(e){return e.props.value===T}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function m(e){var t=(0,r.Z)();return o.createElement(u,(0,a.Z)({key:String(t)},e))}},79443:function(e,t,n){var a=(0,n(67294).createContext)(void 0);t.Z=a},30902:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return u},metadata:function(){return m},toc:function(){return d},default:function(){return f}});var a=n(83117),o=n(80102),r=(n(67294),n(3905)),i=n(55064),l=n(58215),p=n(27839),s=["components"],c={title:"Mini Program Performance Optimization Guide"},u=void 0,m={unversionedId:"optimized",id:"version-3.x/optimized",isDocsHomePage:!1,title:"Mini Program Performance Optimization Guide",description:"Compared to Taro 1/2, Taro 3 is a runtime-heavy, compile-time framework with some performance loss. Therefore, Taro 3 provides a series of performance optimizations to improve the performance of Taro 3 applications.",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-3.x/optimized.mdx",sourceDirName:".",slug:"/optimized",permalink:"/taro/en/docs/optimized",editUrl:"https://github.com/nervjs/taro/edit/docs/versioned_docs/version-3.x/optimized.mdx",tags:[],version:"3.x",frontMatter:{title:"Mini Program Performance Optimization Guide"},sidebar:"version-3.x/docs",previous:{title:"jQuery-like API",permalink:"/taro/en/docs/jquery-like"},next:{title:"Prerender",permalink:"/taro/en/docs/prerender"}},d=[{value:"Optimize update performance",id:"optimize-update-performance",children:[{value:"1. Global configuration item baseLevel",id:"1-global-configuration-item-baselevel",children:[],level:3},{value:"2. CustomWrapper Component",id:"2-customwrapper-component",children:[],level:3}],level:2},{value:"Optimize initial rendering performance",id:"optimize-initial-rendering-performance",children:[],level:2},{value:"Optimize long list performance",id:"optimize-long-list-performance",children:[],level:2},{value:"Jump Preload",id:"jump-preload",children:[],level:2},{value:"Writing Best Practices",id:"writing-best-practices",children:[{value:"1. Deleting floor nodes should be handled with care",id:"1-deleting-floor-nodes-should-be-handled-with-care",children:[{value:"Solution",id:"solution",children:[],level:5}],level:3},{value:"2. The properties of the base component are to remain referenced",id:"2-the-properties-of-the-base-component-are-to-remain-referenced",children:[{value:"Solution:",id:"solution-1",children:[],level:4}],level:3},{value:"3. Do not mount additional properties on the base component",id:"3-do-not-mount-additional-properties-on-the-base-component",children:[],level:3}],level:2}],h={toc:d};function f(e){var t=e.components,n=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Compared to Taro 1/2, Taro 3 is a runtime-heavy, compile-time framework with some performance loss. Therefore, Taro 3 provides a series of performance optimizations to improve the performance of Taro 3 applications."),(0,r.kt)("h2",{id:"optimize-update-performance"},"Optimize update performance"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This optimization has proven to significantly reduce update lag in Taro3, especially on low-end machines.")),(0,r.kt)("p",null,"Taro3 uses the mini program's ",(0,r.kt)("inlineCode",{parentName:"p"},"template")," for rendering and does not normally use native custom components. This leads to the problem that all ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," updates are called from the page object, and if we have a complex page structure, the performance of the updates will be degraded."),(0,r.kt)("p",null,"The data structure of ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," when the hierarchy is too deep."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'page.setData({\n  "root.cn.[0].cn.[0].cn.[0].cn.[0].markers": []\n})\n')),(0,r.kt)("p",null,"The main idea for this problem is to ",(0,r.kt)("strong",{parentName:"p"},"borrow the native custom component of the mini program to achieve a local update effect"),", thus improving the update performance."),(0,r.kt)("p",null,"Desired ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," data structure."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'component.setData({\n  "cn.[0].cn.[0].markers": []\n})\n')),(0,r.kt)("p",null,"There are two ways for developers to implement this optimization."),(0,r.kt)("h3",{id:"1-global-configuration-item-baselevel"},"1. Global configuration item baseLevel"),(0,r.kt)("p",null,"For mini program that do not support template recursion (WeChat, QQ, Jingdong mini-program), Taro will use native custom components to assist recursion after the DOM level reaches a certain number."),(0,r.kt)("p",null,"The simple understanding is that after the DOM structure exceeds N levels, the native custom component will be used for rendering. N is 16 levels by default, and can be changed by modifying the configuration item ",(0,r.kt)("a",{parentName:"p",href:"https://taro-docs.jd.com/taro/docs/next/config-detail#minibaselevel"},"baseLevel")," to modify N."),(0,r.kt)("p",null,"Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"baseLevel")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"8")," or even ",(0,r.kt)("inlineCode",{parentName:"p"},"4")," layers can be very effective in improving performance during updates. However, the setting is global and can cause several problems."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"flex")," layouts will fail across native custom components, which is one of the most impactful issues."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("a",{parentName:"li",href:"https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.select.html"},"descendant selector across custom components")," of the ",(0,r.kt)("inlineCode",{parentName:"li"},"SelectorQuery.select")," method needs to be written Add ",(0,r.kt)("inlineCode",{parentName:"li"},">>>"),": ",(0,r.kt)("inlineCode",{parentName:"li"},".the-ancestor >>> .the-descendant"))),(0,r.kt)("h3",{id:"2-customwrapper-component"},"2. CustomWrapper Component"),(0,r.kt)("p",null,"To solve the problem of inflexible global configuration, we have added a base component ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomWrapper"),". Its role is to create a native custom component from which the ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," of the descendant nodes will be called to achieve a local update effect."),(0,r.kt)("p",null,"Developers can use it to ",(0,r.kt)("strong",{parentName:"p"},"wrap modules that are experiencing update performance issues")," and improve performance when updating. Because the ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomWrapper"),' component needs to be used manually, developers can be aware that "this layer uses a custom component and needs to avoid two problems with custom components".'),(0,r.kt)(i.Z,{defaultValue:"React",values:[{label:(0,r.kt)(p.gQ,{mdxType:"ReactIcon"}),value:"React"},{label:(0,r.kt)(p.p6,{mdxType:"VueIcon"}),value:"Vue"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="Sample code"',title:'"Sample','code"':!0},"import { View, Text } from '@tarojs/components'\n\nexport default function () {\n  return (\n    <View className='index'>\n      <Text>Demo</Text>\n      <CustomWrapper>\n        <GoodsList />\n      </CustomWrapper>\n    </View>\n  )\n}\n"))),(0,r.kt)(l.Z,{value:"Vue",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="Sample code"',title:'"Sample','code"':!0},"<template>\n  <view class=\"index\">\n    <text>Demo</text>\n    <custom-wrapper>\n      <GoodsList />\n    </custom-wrapper>\n  </view>\n</template>\n\n<script>\nimport GoodsList from '@/components/goods-list'\n\nexport default {\n  components: {\n    GoodsList\n  }\n}\n<\/script>\n")))),(0,r.kt)("h2",{id:"optimize-initial-rendering-performance"},"Optimize initial rendering performance"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usually it is not necessary to turn on, please use it according to the actual situation.")),(0,r.kt)("p",null,"When the amount of data rendered at first time is very large, it may cause the page to be white screened for some time. Therefore, Taro provides ","[prerender]"," function to solve this problem."),(0,r.kt)("h2",{id:"optimize-long-list-performance"},"Optimize long list performance"),(0,r.kt)("p",null,"For long list scenarios, Taro provides the ",(0,r.kt)("a",{parentName:"p",href:"virtual-list"},"VirtualList")," component to help developers optimize."),(0,r.kt)("p",null,"It ",(0,r.kt)("strong",{parentName:"p"},"rends only the components in the currently visible area"),", and the components in the non-visible area will be rendered after the user scrolls to the visible area, thus reducing the number of components actually rendered and optimizing the rendering performance."),(0,r.kt)("h2",{id:"jump-preload"},"Jump Preload"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The componentWillPreload hook provided in Taro 1 / 2 is deprecated in Taro 3.")),(0,r.kt)("p",null,"In the mini program, there is a delay from calling the routing jump API such as ",(0,r.kt)("inlineCode",{parentName:"p"},"Taro.navigateTo")," to triggering ",(0,r.kt)("inlineCode",{parentName:"p"},"onLoad")," on the mini program page, so some network requests can be advanced to the moment before the jump is initiated."),(0,r.kt)("p",null,"Taro 3 provides the ",(0,r.kt)("inlineCode",{parentName:"p"},"Tato.preload")," API, which allows you to pass the content to be preloaded as a parameter, and then get the preloaded content after the new page is loaded via ",(0,r.kt)("inlineCode",{parentName:"p"},"Taro.getCurrentInstance().preloadData"),"."),(0,r.kt)("p",null,"Example:"),(0,r.kt)(i.Z,{defaultValue:"React",values:[{label:(0,r.kt)(p.gQ,{mdxType:"ReactIcon"}),value:"React"},{label:(0,r.kt)(p.p6,{mdxType:"VueIcon"}),value:"Vue"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="Sample code"',title:'"Sample','code"':!0},"// A Page\n// Before calling the jump method use Taro.preload\nTaro.preload(fetchSomething())\nTaro.navigateTo({ url: '/pages/B/B' })\n\n// B Page\ncomponentWillMount () {\n  console.log(Taro.getCurrentInstance().preloadData)\n}\n"))),(0,r.kt)(l.Z,{value:"Vue",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Sample code"',title:'"Sample','code"':!0},"// A Page\n// Before calling the jump method use Taro.preload\nTaro.preload(fetchSomething())\nTaro.navigateTo({ url: '/pages/B/B' })\n\n// B \u9875\u9762\nmounted () {\n  console.log(Taro.getCurrentInstance().preloadData)\n}\n")))),(0,r.kt)(i.Z,{defaultValue:"React",values:[{label:(0,r.kt)(p.gQ,{mdxType:"ReactIcon"}),value:"React"},{label:(0,r.kt)(p.p6,{mdxType:"VueIcon"}),value:"Vue"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u793a\u4f8b\u4ee3\u7801\uff08\u7528\u6cd5\u4e8c\uff09"',title:'"\u793a\u4f8b\u4ee3\u7801\uff08\u7528\u6cd5\u4e8c\uff09"'},"// A \u9875\u9762\nTaro.preload('x', 1)\nTaro.navigateTo({ url: '/pages/B/B' })\n\n// B \u9875\u9762\ncomponentWillMount () {\n  console.log(Taro.getCurrentInstance().preloadData)\n}\n"))),(0,r.kt)(l.Z,{value:"Vue",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Sample code"',title:'"Sample','code"':!0},"// A Page\nTaro.preload('x', 1)\nTaro.navigateTo({ url: '/pages/B/B' })\n\n// B Page\nmounted () {\n  console.log(Taro.getCurrentInstance().preloadData)\n}\n")))),(0,r.kt)("h2",{id:"writing-best-practices"},"Writing Best Practices"),(0,r.kt)("p",null,"Two factors that have a significant impact on the performance of the mini program are the ",(0,r.kt)("strong",{parentName:"p"},"amount of data")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," and the ",(0,r.kt)("strong",{parentName:"p"},"number of calls")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," function per unit time."),(0,r.kt)("p",null,"Printing the ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," data in the project will be very useful to help pinpoint the problem when performance issues are encountered. Developers can search to locate the location of the ",(0,r.kt)("inlineCode",{parentName:"p"},".setData")," call by going to the ",(0,r.kt)("inlineCode",{parentName:"p"},"dist/taro.js")," file in the Taro project and then print the data."),(0,r.kt)("p",null,"In Taro, a ",(0,r.kt)("strong",{parentName:"p"},"batch")," bundle update operation is done on ",(0,r.kt)("inlineCode",{parentName:"p"},"setData"),", so more often than not, only the size of the ",(0,r.kt)("strong",{parentName:"p"},"setData data")," needs to be considered."),(0,r.kt)("p",null,"The following is our list of writing issues that developers need to be aware of"),(0,r.kt)("h3",{id:"1-deleting-floor-nodes-should-be-handled-with-care"},"1. Deleting floor nodes should be handled with care"),(0,r.kt)("p",null,"Suppose there is such a structure."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<View>\n  \x3c!-- Rotation --\x3e\n  <Slider />\n  <Goods />\n  \x3c!-- Modal --\x3e\n  {isShowModal && <Modal />}\n</View>\n")),(0,r.kt)("p",null,"Taro3's current handling of node deletion is flawed. When ",(0,r.kt)("inlineCode",{parentName:"p"},"isShowModal")," changes from ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),", the modal popup disappears. At this point, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Modal")," component's sibling nodes are updated, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," data is the DOM node information for the ",(0,r.kt)("inlineCode",{parentName:"p"},"Slider")," + ",(0,r.kt)("inlineCode",{parentName:"p"},"Goods")," components."),(0,r.kt)("p",null,"In general, the impact is not too great and the developer does not need to be mentally burdened by it. However, if the DOM structure of the sibling node to be deleted is very complex, such as a floor component, the side effect of the delete operation will result in a large amount of ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," data, which will affect performance."),(0,r.kt)("h5",{id:"solution"},"Solution"),(0,r.kt)("p",null,"We can currently isolate the delete operation by optimizing it in this way."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<View>\n  \x3c!-- Rotation --\x3e\n  <Slider />\n  <Goods />\n  \x3c!-- Modal --\x3e\n  <View>\n    {isShowModal && <Modal />}\n  </View>\n</View>\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We are optimizing the algorithm for deleting nodes to completely circumvent this unnecessary setData, which was released in v3.1.")),(0,r.kt)("h3",{id:"2-the-properties-of-the-base-component-are-to-remain-referenced"},"2. The properties of the base component are to remain referenced"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"React")),(0,r.kt)("p",null,"Assuming that the values of the properties of the base components (such as ",(0,r.kt)("inlineCode",{parentName:"p"},"View"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Input"),", etc.) are non-basic types, try to keep the object references."),(0,r.kt)("p",null,"Assume the following writing style\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<Map\n  latitude={22.53332}\n  longitude={113.93041}\n  markers={[{\n    latitude: 22.53332,\n    longitude: 113.93041\n  }]}\n/>\n")),(0,r.kt)("p",null,"Every time we render, React does a shallow comparison of the properties of the base component, and when we find that the reference to ",(0,r.kt)("inlineCode",{parentName:"p"},"markers")," is different, we will update the component properties. This results in more ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," and more ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," data."),(0,r.kt)("h4",{id:"solution-1"},"Solution:"),(0,r.kt)("p",null,"References to objects can be maintained by means of ",(0,r.kt)("inlineCode",{parentName:"p"},"state"),", closures, etc."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<Map\n  latitude={22.53332}\n  longitude={113.93041}\n  markers={this.state.markers}\n/>\n")),(0,r.kt)("h3",{id:"3-do-not-mount-additional-properties-on-the-base-component"},"3. Do not mount additional properties on the base component"),(0,r.kt)("p",null,"Basic components (such as ",(0,r.kt)("inlineCode",{parentName:"p"},"View"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Input"),", etc.) that set non-standard properties are currently ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," along with these additional properties, which are not actually ignored by the mini program, so this part of ",(0,r.kt)("inlineCode",{parentName:"p"},"setData")," is redundant."),(0,r.kt)("p",null,"For example, the standard properties of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Text")," component are ",(0,r.kt)("inlineCode",{parentName:"p"},"selectable"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"user-select"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"space "),", ",(0,r.kt)("inlineCode",{parentName:"p"},"decode"),". If we set an additional property ",(0,r.kt)("inlineCode",{parentName:"p"},"something")," for it, then this additional property will also be setData."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"<Text something='extra' />\n")))}f.isMDXComponent=!0}}]);