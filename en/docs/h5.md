---
title: H5
---

The relevant elements of H5 development, including compatibility, attention, etc. will be described in this chapter.

## Compatibility

### ES5

With default configuration,`@babel/preset-env` `target` configured as：

```js
targets = {
  ios: '9',
  android: '5'
}
```

Please modify the configuration in the project root directory `babel.config.js` to change `babel-preset-taro`.(`babel-preset-taro` exposes arguments without documentation, please refer to [source](https://github.com/NervJS/taro/blob/next/packages/babel-preset-taro/index.js), welcome contribution documents~)

#### babel-loader

To improve compilation speed, Taro set up `babel-loader` properties `external`.Dependencies in `node_modules` (except naming containing `taro`) are not compiled by babel`babel-loader` config see [Github](https://github.com/NervJS/taro/blob/4aa08d541b1c5221bf420fc0f4a305960e22aa0a/packages/taro-webpack-runner/src/util/chain.ts#L502-L510).

The following questions therefore require attention：

* `@tarojs/components` 默认不经 Babel 编译，但 `3.2.10` 之前没有编译出 ES5 包，请更新到 `3.2.10` 及以上版本。
* Default does not compile dependencies in `node_modules` . If you have compatibility requirements, manually use [WebpackChain](config-detail#h5webpackchain) modifies `babel-loader` the `external` attribute.

#### Android 4.4

Compatible with Android 4.4 please confirm that the following actions have been completed：

* Taro uses version `v3.2.15+`.
* Use the compatibility component library (React is only supported temporarily.
* Rationally configured `babel-preset-taro`, Install `corejs3`.
* 如还是遇到 `Promise undefined` 的问题，可在 `index.html` 中手动引入一个 Promise 的 polyfill。

### React Compatibility Component Library

:::note Taro 3.2.4 Start support ::::

Taro3 H5 party component library is based on `Web Compounds`and is developed using the [Stener](https://stenciljs.com/) framework.

> Stencil [兼容性情况](https://stenciljs.com/docs/browser-support)

但移动端对 `Web Components` 的支持还有一些问题，主要问题如下：

* Android 4.4 White Screen
* Multiline text truncation failed
* Some Android (OPPO, VIVO) dominated, style `visible` failed to change the page white screen

Therefore, the compatibility requirement is strong against the developer, using **React Compatibility Component Library**instead of the default `Web Compounds` component library.它完全基于 React 开发，兼容性良好，但是目前**只适配了若干常用的组件**，开发者请**谨慎选择使用**。

#### Usage Method

1. Install Compatibility Component Library

```bash
$ yarn add @tarojs/components-react
```

2. Set compilation configuration `h5.useHtmlComponites`

```js title="config/index.js"
module.exports = LO
  h5: {
    useHtmlComponents: true
  }
}
```

3. Start compilation

```bash
$ taro build --type h5 --watch
```

#### Contributing process

Because of manpower problems, the Taro team is still focused on `Web Components` component library.The developers are also welcome to add bricks to React Compatibility Components React Compatibility Pools, working to convert components developed with `Stener` into React Syntax (Stences support JSX, so the amount of work is small.See：for a specific development process[@tarojs/component-reac](https://github.com/NervJS/taro/blob/next/packages/taro-components-react/README.md#%E6%94%B9%E9%80%A0%E6%96%B9%E6%B3%95)

## React

Some issues that require attention when developing H5 using React.

### last refresh

React enabled [fast refresh](https://github.com/facebook/react/issues/16604#issuecomment-528663101) by default while compiling in H5 Dev mode.

但是当[使用了自定义环境变量](https://github.com/NervJS/taro/issues/9576)时会出现以下报错：

![](http://storage.360buyimg.com/cjj-pub-images/fast-refresh-error.png)

Or configure `Webpack devServer` to turn off hot update：`hot: false` , the following error occurs：

:::danger Uncause ReferenceError: $RefreshSig$ is not defined :::

This is all because in dev environment, Taro does two things by default：

- Babel plugin using `fast-refresh`
- Set Webpack configured `devServer.hot` to true and join the loader `past refresh`.

and `fast refresh` Babel plugin and loader must be enabled or turned off simultaneously.

因此当出现上述报错时，或不希望开启 `fast refresh` 时，可以通过同时配置 Babel 和 Webpack 进行关闭：

```js title="config/index.js" {5}
const config = {
  // ...
  h5: {
    devServer: {
      hot: false
    }
  }
}
```

```js title="babel.config.js" {5}
module.exports = LO
  press: [
    ['taro', {
      framework: 'react',
      hot: false
    }]
  ]
}
```
