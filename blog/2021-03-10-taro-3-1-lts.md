---
slug: 2021-03-10-taro-3-1-lts
title: Taro æ­£å¼å‘å¸ƒ 3.1 ç‰ˆæœ¬
author: JJ
author_url: https://github.com/Chen-jj
author_image_url: https://storage.jd.com/cjj-pub-images/11807297.png
tags: [v3]
description: è‡ª Taro 3.1 ä½“éªŒç‰ˆæ¨å‡ºåï¼Œæˆ‘ä»¬ä¸æ–­åœ°æ ¹æ®ç¤¾åŒºçš„åé¦ˆæ„è§å¯¹ 3.1 ç‰ˆæœ¬è¿›è¡Œæ‰“ç£¨ã€‚ç»å†äº† 12 ä¸ª beta ç‰ˆæœ¬åï¼Œç»ˆäºè¿æ¥äº† 3.1 æ­£å¼ç‰ˆã€‚
---

è‡ª Taro 3.1 ä½“éªŒç‰ˆæ¨å‡ºåï¼Œæˆ‘ä»¬ä¸æ–­åœ°æ ¹æ®ç¤¾åŒºçš„åé¦ˆæ„è§å¯¹ 3.1 ç‰ˆæœ¬è¿›è¡Œæ‰“ç£¨ã€‚ä¸»è¦æ”¹è¿›äº†**å¼€æ”¾å¼æ¶æ„**ã€å¼•å…¥äº† `CustomWrapper` ç»„ä»¶ä»¥è§£å†³æ€§èƒ½é—®é¢˜ã€æå‡ºäº†åŸç”Ÿå°ç¨‹åº**æ¸è¿›å¼æ··åˆä½¿ç”¨ Taro** çš„è§£å†³æ–¹æ¡ˆã€‚

ç»å†äº† 12 ä¸ª beta ç‰ˆæœ¬åï¼Œç»ˆäºè¿æ¥äº† 3.1 æ­£å¼ç‰ˆğŸ‰

## ä¸€ã€Highlights

### 1. å¼€æ”¾å¼æ¶æ„

è¿‘å¹´æ¥ä¸šç•Œæ¨å‡ºçš„å°ç¨‹åºå¹³å°è¶Šæ¥è¶Šå¤šï¼Œä½† Taro æ ¸å¿ƒç»´æŠ¤çš„å¹³å°åªæœ‰ 6 ä¸ªï¼Œå› æ­¤å¸¸å¸¸æœ‰åŒå­¦æå‡ºèƒ½ä¸èƒ½æ”¯æŒæŸæŸå¹³å°çš„ Feature Requestã€‚

åŸºäºç›®å‰çš„æ¶æ„ï¼Œæ”¯æŒä¸€ä¸ªæ–°çš„å¹³å°å¼€å‘å¤æ‚åº¦é«˜ï¼ŒåŒæ—¶ç¤¾åŒºä¹Ÿéš¾ä»¥å‚ä¸è´¡çŒ®ã€‚

ä¸ºæ­¤æˆ‘ä»¬æŠŠ Taro æ‰“é€ æˆä¸ºä¸€ä¸ªå¼€æ”¾å¼æ¡†æ¶ï¼Œ**é€šè¿‡ç«¯å¹³å°æ’ä»¶èƒ½æ”¯æŒä»»æ„å°ç¨‹åºå¹³å°**ï¼š

- **æ’ä»¶å¼€å‘è€…**æ— éœ€ä¿®æ”¹ Taro é¡¹ç›®æºç ï¼Œå³å¯[ç¼–å†™å‡ºä¸€ä¸ªç«¯å¹³å°æ’ä»¶](https://taro-docs.jd.com/taro/docs/next/platform-plugin-how)ã€‚
- **æ’ä»¶ä½¿ç”¨è€…**åªéœ€[å®‰è£…ã€é…ç½®ç«¯å¹³å°æ’ä»¶](https://taro-docs.jd.com/taro/docs/next/platform-plugin#%E7%AB%AF%E5%B9%B3%E5%8F%B0%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A)ï¼Œå³å¯æŠŠä»£ç ç¼–è¯‘åˆ°æŒ‡å®šå¹³å°ã€‚

åŸºäºå¼€æ”¾å¼æ¶æ„ï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸€äº›æœ‰è¶£çš„æ’ä»¶ï¼Œä¹Ÿååˆ†æœŸå¾…å¤§å®¶åˆ©ç”¨å®ƒæ–½å±•åˆ›æ„ã€‚

#### æ–°å¢çš„æ’ä»¶ï¼š

| æ’ä»¶ | åŠŸèƒ½ |
| :--- | :--- |
| [@tarojs/plugin-platform-weapp-qy](https://github.com/NervJS/taro-plugin-platform-weapp-qy) | ç¼–è¯‘ä¼ä¸šå¾®ä¿¡å°ç¨‹åº |
| [@tarojs/plugin-platform-alipay-dd](https://github.com/NervJS/taro-plugin-platform-alipay-dd) | ç¼–è¯‘é’‰é’‰å°ç¨‹åº |
| [@tarojs/plugin-platform-alipay-iot](https://github.com/NervJS/taro-plugin-platform-alipay-iot) | ç¼–è¯‘æ”¯ä»˜å® IOT å°ç¨‹åº |
| [@tarojs/plugin-inject](https://github.com/NervJS/taro-plugin-inject) | ä¸ºæ‰€æœ‰å°ç¨‹åºå¹³å°å¿«é€Ÿæ–°å¢ **API**ã€**ç»„ä»¶**ï¼Œ**è°ƒæ•´ç»„ä»¶å±æ€§**ç­‰ |

### 2. æ–°å¢å°ç¨‹åºæ€§èƒ½ä¼˜åŒ–ç»„ä»¶ CustomWrapper

Taro3 ä½¿ç”¨ `<template>` è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€æœ‰çš„ `setData` éƒ½ç”±é¡µé¢å¯¹è±¡è°ƒç”¨ã€‚å¦‚æœé¡µé¢ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œåº”ç”¨æ›´æ–°çš„æ€§èƒ½å°±ä¼šä¸‹é™ã€‚

ä¸ºæ­¤æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªåŸºç¡€ç»„ä»¶ `CustomWrapper`ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªåŸç”Ÿè‡ªå®šä¹‰ç»„ä»¶ã€‚å¯¹åä»£èŠ‚ç‚¹çš„ `setData` å°†ç”±æ­¤è‡ªå®šä¹‰ç»„ä»¶è¿›è¡Œè°ƒç”¨ï¼Œ**è¾¾åˆ°å±€éƒ¨æ›´æ–°çš„æ•ˆæœ**ï¼Œä»è€Œæå‡æ›´æ–°æ€§èƒ½ã€‚

å¼€å‘è€…å¯ä»¥ä½¿ç”¨  `CustomWrapper` å»åŒ…è£¹é‡åˆ°æ›´æ–°æ€§èƒ½é—®é¢˜çš„ç»„ä»¶ï¼š

```jsx
<CustomWrapper>
  <GoodsList>
    <Item />
    <Item />
    // ...
  </GoodsList>
</CustomWrapper>
```

> æ›´è¯¦ç»†çš„æ€§èƒ½ä¼˜åŒ–åŸç†è¯·è§[ã€ŠTaro åŠ©åŠ›äº¬å–œæ‹¼æ‹¼é¡¹ç›®æ€§èƒ½ä½“éªŒä¼˜åŒ–ã€‹](https://docs.taro.zone/blog/2021-02-08-taro-jxpp#2-%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96)

### 3. åŸç”Ÿå°ç¨‹åºæ¸è¿›å¼æ··åˆä½¿ç”¨ Taro å¼€å‘

è¿‡å»æˆ‘ä»¬å¯¹åœ¨ Taro é¡¹ç›®ä¸­æ··åˆä½¿ç”¨åŸç”Ÿçš„æ”¯æŒåº¦è¾ƒé«˜ã€‚ç›¸ååœ°ï¼Œå¯¹åœ¨åŸç”Ÿé¡¹ç›®ä¸­æ··åˆä½¿ç”¨ Taro å´æ²¡æœ‰å¤ªé‡è§†ã€‚ä½†æ˜¯å¸‚é¢ä¸Šæœ‰ç€å­˜é‡çš„åŸç”Ÿå¼€å‘å°ç¨‹åºï¼Œä»–ä»¬æ¥å…¥ Taro å¼€å‘çš„æ”¹é€ æˆæœ¬å¾€å¾€éå¸¸å¤§ï¼Œæœ€ååªå¾—æ”¾å¼ƒæ··åˆå¼€å‘çš„æƒ³æ³•ã€‚

[ç»è¿‡ä¸äº¬å–œæ‹¼æ‹¼é¡¹ç›®çš„åˆä½œ](https://docs.taro.zone/blog/2021-02-08-taro-jxpp)ï¼Œä¹Ÿé©±ä½¿äº†æˆ‘ä»¬æ›´åŠ å…³æ³¨è¿™éƒ¨åˆ†éœ€æ±‚ã€‚Taro æ¨å‡ºäº†ä¸€å¥—å®Œæ•´çš„åŸç”Ÿé¡¹ç›®æ··åˆä½¿ç”¨ Taro çš„æ–¹æ¡ˆã€‚

[æ–¹æ¡ˆ](https://docs.taro.zone/docs/taro-in-miniapp)ä¸»è¦æ”¯æŒäº†ä¸‰ç§åœºæ™¯ï¼š

- åœ¨åŸç”Ÿé¡¹ç›®ä¸­ä½¿ç”¨ Taro å¼€å‘çš„é¡µé¢ã€‚ï¼ˆå·²å®Œæˆï¼‰
- åœ¨åŸç”Ÿé¡¹ç›®çš„åˆ†åŒ…ä¸­è¿è¡Œå®Œæ•´çš„ Taro é¡¹ç›®ã€‚ï¼ˆå·²å®Œæˆï¼‰
- åœ¨åŸç”Ÿé¡¹ç›®ä¸­ä½¿ç”¨ Taro å¼€å‘çš„è‡ªå®šä¹‰ç»„ä»¶ã€‚ï¼ˆå°†åœ¨ v3.1.3 ç‰ˆæœ¬ä¸­æ”¯æŒï¼‰

å¸Œæœ›ä»¥ä¸Šæ–¹æ¡ˆèƒ½æ»¡è¶³æ‰“ç®—é€æ­¥æ¥å…¥ Taro å¼€å‘çš„åŒå­¦ã€‚æ›´å¤šæ„è§ä¹Ÿæ¬¢è¿åœ¨ [Github](https://github.com/NervJS/taro) ä¸Šç»™æˆ‘ä»¬ç•™è¨€ã€‚

### 4. æ‹¥æŠ± React 17ã€TypeScript 4

#### 4.1. ä½¿ç”¨æ–¹æ³•

##### æ–°é¡¹ç›®ï¼š

æ¨¡æ¿é»˜è®¤ä¾èµ– React 17ã€TypeScript 4ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

##### æ—§é¡¹ç›®ï¼š

æ‰‹åŠ¨å‡çº§é¡¹ç›®ä¾èµ–ï¼š

- `react: ^17.0.0`
- `react-dom: ^17.0.0`
- `typescript: ^4.1.0`
- `@typescript-eslint/parser: ^4.15.1`
- `@typescript-eslint/eslint-plugin: ^4.15.1`

è®¾ç½® ESLint é…ç½®ï¼š

```js
// .eslintrc
module.exports = {
  "extends": ["taro/react"],
  "rules": {
    "react/jsx-uses-react": "off",
    "react/react-in-jsx-scope": "off"
  }
}
```

#### 4.2. React é»˜è®¤æ”¯æŒ [New JSX Transform](https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html)

New JSX Transform è®©å¼€å‘è€…**ä¸å†éœ€è¦åœ¨ä¹¦å†™ JSX å‰å…ˆå¼•å…¥ React**ã€‚

å¦‚æœä¸å¸Œæœ›æ‰“å¼€æ­¤åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ Babel é…ç½®çš„ `reactJsxRuntime` é€‰é¡¹ä¸º `classes`ï¼š

```js
// babel.config.js
module.exports = {
  presets: [
    ['taro', {
      framework: 'react',
      ts: true,
      reactJsxRuntime: 'classes'
    }]
  ]
}
```

#### 4.3. React H5 ç«¯é»˜è®¤å¼€å¯ [fast-refresh](https://github.com/facebook/react/issues/16604#issuecomment-528663101)

å¦‚æœä¸å¸Œæœ›æ‰“å¼€æ­¤åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ Taro é…ç½®å’Œ Babel é…ç½®ï¼š

```js
// config/index.js
const config = {
  h5: {
    devServer: {
      hot: false
    }
  }
}

// babel.config.js
module.exports = {
  presets: [
    ['taro', {
      framework: 'react',
      ts: true,
      hot: false
    }]
  ]
}
```

## äºŒã€Breakings

### 1. React

é¡¹ç›®çš„ React ç‰ˆæœ¬å¿…é¡» **>= 16.14.0**ï¼Œæˆ–ä½¿ç”¨ **17.0.0+**

### 2. Vue2

> ä¿®å¤ Vue2 å…¥å£ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¤šæ¬¡è§¦å‘çš„é—®é¢˜ï¼Œ#7179

ç”¨æˆ·ç¼–å†™çš„å…¥å£ç»„ä»¶éœ€è¦ä¿®æ”¹å¦‚ä¸‹ï¼š

```js
// app.js

// 3.0 ä¸­éœ€è¦åˆ›å»º Vue å¯¹è±¡
const App = new Vue({})

// 3.1 ä¸­åªéœ€è¦è¿”å›å¯¹è±¡å­—é¢é‡
const App = {}
```

## ä¸‰ã€ç‰¹æ€§

- ç»„ä»¶ `View` å¢åŠ  `catchMove` å±æ€§ï¼Œè§£å†³[æ»šåŠ¨ç©¿é€](https://docs.taro.zone/docs/next/react#%E9%98%BB%E6%AD%A2%E6%BB%9A%E5%8A%A8%E7%A9%BF%E9%80%8F)é—®é¢˜ã€‚
- åŒæ­¥æ‰€æœ‰å†…ç½®å°ç¨‹åºå®˜æ–¹æœ€æ–°çš„ APIã€ç»„ä»¶èƒ½åŠ›ã€‚

## å››ã€é—®é¢˜ä¿®å¤

### 1. é‡è¦

- ä¿®å¤ç™¾åº¦å°ç¨‹åºæ¸²æŸ“é—®é¢˜ï¼Œ#7293ã€‚
- ä¿®å¤ã€å¢å¼ºå¾®ä¿¡å°ç¨‹åºè½¬æ¢ä¸º Taro çš„èƒ½åŠ›ã€‚
- ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯ã€‚
- æ”¯ä»˜å®å°ç¨‹åºæ”¯æŒå¼•ç”¨è‡ªå®šä¹‰ç»„ä»¶ã€‚
- ä¿®å¤å°ç¨‹åºåˆ†äº« API åœ¨ä½¿ç”¨ redux æ—¶æ— æ³•ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œ#7232ã€‚

### 2. å°ç¨‹åº

- ä¿®å¤å¤šç«¯æ–‡ä»¶æ²¡æŒ‰ç…§ Webpack `extension` é…ç½®è§£æçš„é—®é¢˜ï¼Œ#6786ï¼Œ#7265 ã€‚
- ä¿®å¤ style å±æ€§è®¾ç½®å¤±è´¥çš„é—®é¢˜ï¼Œ#8678ã€‚

### 3. H5

- ä¿®å¤ H5 ç«¯ HMR å¤±æ•ˆçš„é—®é¢˜ã€‚
- æ”¯æŒè·¯ç”± **404** æ—¶è§¦å‘ `App.onPageNotFound`ï¼Œ#7474ã€‚
- ä¿®å¤è¡¨å•ç»„ä»¶ `slot` å…¼å®¹é—®é¢˜ï¼Œ#7363ã€‚
- ä¿®å¤ `View` å’Œ `Text` ç»„ä»¶å¤šè¡Œæˆªæ–­æ ·å¼å¤±è´¥é—®é¢˜ï¼Œ#7472 #6741ã€‚
- ç»„ä»¶çš„ `style` å±æ€§æ”¯æŒè®¾ç½® CSS å˜é‡ï¼Œ#7452ã€‚

## äº”ã€å‡çº§æŒ‡å—

> ä» v2.x å‡çº§çš„åŒå­¦éœ€è¦å…ˆæŒ‰ [è¿ç§»æŒ‡å—](https://taro-docs.jd.com/taro/docs/next/migration) è¿›è¡Œæ“ä½œã€‚

ä» v3.x å‡çº§çš„åŒå­¦ï¼Œé¦–å…ˆéœ€è¦å®‰è£… v3.1 çš„ CLI å·¥å…·ï¼š

```bash
npm i -g @tarojs/cli
```

ç„¶åè¿›å…¥é¡¹ç›®ï¼Œåˆ é™¤ **node_modules**ã€**yarn.lock**ã€**package-lock.json**ã€‚

æœ€åæŠŠ `package.json` æ–‡ä»¶ä¸­ Taro ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ä¿®æ”¹ä¸º `^3.1.0`ï¼Œå†é‡æ–°å®‰è£…ä¾èµ–ã€‚è‡³æ­¤å‡çº§ç»“æŸã€‚

## å…­ã€æœªæ¥è§„åˆ’

å¾—ç›Šäº [58 æŠ€æœ¯å›¢é˜Ÿ](https://github.com/wuba) çš„å…¨åŠ›æ”¯æŒï¼ŒTaro 3 å³å°†æ”¯æŒ **React Native**ï¼Œç°å·²æ¨å‡º 3.2.0 çš„ Beta ç‰ˆæœ¬ï¼Œ3.2.0 æ­£å¼ç‰ˆå°†äºæœ¬æœˆåº•æ¨å‡ºã€‚æ¬¢è¿æŠ¢å…ˆä½“éªŒï¼š[ã€Šå¢åŠ  React Native æ”¯æŒçš„ Taro 3.2.0 ç‰ˆæœ¬æµ‹è¯•é€šå‘Šã€‹](https://taro-docs.jd.com/taro/blog/2020-12-02-taro-3-2-0-cannary-1)

## ä¸ƒã€æ„Ÿè°¢

å¼€æºä¸æ˜“ï¼Œè´µåœ¨åšæŒã€‚Taro å›¢é˜Ÿè¡·å¿ƒæ„Ÿè°¢å„ä½å‚ä¸è¿‡æœ¬é¡¹ç›®å¼€æºå»ºè®¾çš„æœ‹å‹ï¼Œæ— è®ºæ˜¯ä¸º Taro æäº¤è¿‡ä»£ç ã€å»ºè®¾å‘¨è¾¹ç”Ÿæ€ï¼Œè¿˜æ˜¯åé¦ˆè¿‡é—®é¢˜ï¼Œç”šè‡³åªæ˜¯èŒ¶ä½™é¥­åè®¨è®ºã€åæ§½ Taro çš„å„ä½ã€‚

ç°è¯šæŒšé‚€è¯·æ‚¨ä¸ Taro å®˜æ–¹å›¢é˜Ÿäº¤æµæ‚¨çš„ä½¿ç”¨æƒ…å†µï¼Œæœ‰ä½ ç›¸ä¼´ï¼ŒTaroæ›´åŠ ç²¾å½©ï¼[é—®å·åœ°å€](https://wj.qq.com/s2/6494361/09cf)

æœ€åï¼Œç‰¹åˆ«æ„Ÿè°¢ä¸º Taro ä» v3.0 èµ°åˆ° v3.1 è´¡çŒ®è¿‡ä»£ç çš„å„ä½åŒå­¦ï¼Œä¸åˆ†å…ˆåï¼š

* @wuchangming
* @SyMind
* @zhuxianguo
* @Songkeys
* @vdfor
* @ZeroTo0ne
* @zhaoguoweiLLHC
* @Spencer17x
* @wingsico
* @w91
* @fjc0k
* @Leechael
* @southorange1228
* @alexlees
* @cncolder
* @rottenpen
* @gcxfd
* @twocucao
* @pengtikui
* @kala888
* @LengYXin
* @iugo
* @jin-yufeng
* @xuchengzone
* @csolin
* @xiaoyao96
* @baranwang
* @fred8617
* @huanz
* @Cslove
* @002huiguo
* @jazzqi
* @Jetsly
* @yuezk
* @lukezhange001
* @k55k32
* @Soul-Stone
* @hisanshao
* @gjc9620
* @younthu
* @digiaries
* @GoodbyeNJN
* @Swordword
* @helsonxiao
* @Ininit
* @atzcl
* @taoqf
* @Aysnine
* @cjz9032
* @z3rog
* @doublethinkio
* @Jackyzm
* @ywzou
* @koalaink
* @mosqlee
* @wangjuerong
* @kdxcxs
* @LiHDong
* @ryougifujino
* @GitaiQAQ
* @logix-o
* @CallMeXYZ
